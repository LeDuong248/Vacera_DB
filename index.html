<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vacera Internal Report</title>
    <!-- Tailwind CSS (D√πng CDN cho nhanh, kh√¥ng c·∫ßn c√†i ƒë·∫∑t) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-screen overflow-hidden">
    <!-- ================= Login Screen ================= -->
    <div id="login-modal" class="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full text-center">
            <div class="mb-6 inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold mb-2">B·∫£o m·∫≠t h·ªá th·ªëng</h2>
            <p class="text-slate-500 mb-6">Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u n·ªôi b·ªô ƒë·ªÉ truy c·∫≠p b√°o c√°o.</p>
            
            <form id="login-form" autocomplete="off">
                <input type="password" id="app-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." 
                    class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none mb-4 transition" required>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition shadow-md">
                    Truy c·∫≠p ngay
                </button>
            </form>
            <p id="login-error" class="hidden text-red-500 mt-3 text-sm font-medium">Sai m·∫≠t kh·∫©u r·ªìi ƒë·∫°i ca ∆°i!</p>
        </div>
    </div>
    <!-- ================= Main Screen (Dashboard) ================= -->
    <div id="main-app" class="hidden h-full flex flex-col">
        
        <!-- Header -->
        <header class="bg-white border-b px-4 py-4 flex justify-between items-center shadow-sm shrink-0">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 text-white p-2 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" />
                    </svg>
                </div>
                <h1 class="font-bold text-xl tracking-tight text-slate-800">Vacera <span class="text-blue-600">Report</span></h1>
            </div>
            <button onclick="logout()" class="text-sm font-medium text-slate-500 hover:text-red-600 transition">
                ƒêƒÉng xu·∫•t
            </button>
        </header>
        <!-- Content (Scrollable) -->
        <main class="flex-1 overflow-y-auto p-4 bg-slate-50">
            <div class="max-w-2xl mx-auto">
                
                <!-- Welcome Card -->
                <div class="bg-blue-600 rounded-xl p-6 text-white shadow-lg mb-6">
                    <h2 class="text-2xl font-bold mb-1">Xin ch√†o, Sale Master! üëã</h2>
                    <p class="text-blue-100 opacity-90">H√¥m nay ch·ªët ƒë∆∞·ª£c ƒë∆°n n√†o ch∆∞a? Nh·∫≠p ngay v√†o ƒë√¢y nh√©.</p>
                </div>
                <!-- Form Card -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100">
                        <h3 class="font-bold text-lg text-slate-800">Th√¥ng tin ƒë∆°n h√†ng</h3>
                    </div>
                    
                    <form id="report-form" class="p-6 space-y-5">
                        
                        <!-- Grid 2 Column layout for Tablet/PC -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            
                            <!-- Khu V·ª±c -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Khu V·ª±c</label>
                                <select name="khuvuc" class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                    <option value="" disabled selected>Ch·ªçn khu v·ª±c...</option>
                                    <option value="Mi·ªÅn B·∫Øc">Mi·ªÅn B·∫Øc</option>
                                    <option value="Mi·ªÅn Trung">Mi·ªÅn Trung</option>
                                    <option value="Mi·ªÅn Nam">Mi·ªÅn Nam</option>
                                    <option value="Mi·ªÅn T√¢y">Mi·ªÅn T√¢y</option>
                                </select>
                            </div>
                            <!-- T·ªânh Th√†nh -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">T·ªânh Th√†nh</label>
                                <input name="tinhthanh" type="text" placeholder="V√≠ d·ª•: C·∫ßn Th∆°" class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <!-- ƒê·∫°i L√Ω -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">T√™n ƒê·∫°i L√Ω</label>
                                <input name="daily" type="text" placeholder="Nh·∫≠p t√™n ƒë·∫°i l√Ω..." class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" required>
                            </div>
                            <!-- Nh√¢n Vi√™n Sale -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Nh√¢n Vi√™n Sale</label>
                                <input name="sales" type="text" placeholder="T√™n c·ªßa b·∫°n..." class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" required>
                            </div>
                            <!-- Lo·∫°i H√†ng -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">Lo·∫°i H√†ng</label>
                                <select name="loaihang" class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                    <option value="" disabled selected>Ch·ªçn lo·∫°i h√†ng...</option>
                                    <option value="G·∫°ch b√¥ng">G·∫°ch b√¥ng</option>
                                    <option value="G·∫°ch d·∫ªo">G·∫°ch d·∫ªo</option>
                                    <option value="Th·∫£m">Th·∫£m</option>
                                    <option value="G·ªó">S√†n g·ªó</option>
                                    <option value="Kh√°c">Kh√°c</option>
                                </select>
                            </div>
                            <!-- M√£ H√†ng -->
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">M√£ H√†ng</label>
                                <input name="mahang" type="text" placeholder="VD: VAGB3001" class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                        </div>
                        <!-- Ghi Ch√∫ (Full Width) -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Ghi Ch√∫</label>
                            <textarea name="ghichu" rows="3" placeholder="Ghi ch√∫ th√™m v·ªÅ ƒë∆°n h√†ng ho·∫∑c s·ªë l∆∞·ª£ng..." class="w-full px-3 py-2.5 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"></textarea>
                        </div>
                        <!-- Submit Button -->
                         <button type="submit" id="btn-submit" class="w-full bg-slate-800 hover:bg-slate-700 text-white font-bold py-3.5 rounded-lg shadow-lg transform transition active:scale-[0.98] flex justify-center items-center gap-2">
                            <span>üöÄ G·ª≠i B√°o C√°o Ngay</span>
                        </button>
                    </form>
                </div>
                <!-- Footer -->
                <p class="text-center text-slate-400 text-xs mt-8 mb-4">¬© 2024 Vacera Internal System. Secure Connection.</p>
            </div>
        </main>
    </div>
    <!-- JS Logic -->
    <script>
        // C·∫§U H√åNH LI√äN K·∫æT GOOGLE SHEET
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz2e-DttUORCzk-nyduWyzuHO7yX2hvJDsO385JUqOuKKicdx2APLb79i2bGlLvl-PT/exec';
        
        // M·∫≠t kh·∫©u c·ª©ng ·ªü ph√≠a Client (T·∫°m th·ªùi) - S·∫Ω g·ª≠i k√®m v·ªÅ Server ƒë·ªÉ check l·∫ßn 2
        // B·∫°n c√≥ th·ªÉ ƒë·ªïi pass n√†y
        const CLIENT_PASS = "123456"; 
        // DOM Elements
        const loginModal = document.getElementById('login-modal');
        const mainApp = document.getElementById('main-app');
        const loginForm = document.getElementById('login-form');
        const appPasswordInput = document.getElementById('app-password');
        const reportForm = document.getElementById('report-form');
        const submitBtn = document.getElementById('btn-submit');
        const loginError = document.getElementById('login-error');
        // 1. X·ª¨ L√ù ƒêƒÇNG NH·∫¨P
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const pass = appPasswordInput.value;
            
            // ·ªû ƒë√¢y t·∫°m th·ªùi check pass c·ª©ng ƒë∆°n gi·∫£n.
            // Th·ª±c t·∫ø security n·∫±m ·ªü Google Apps Script (Server).
            // Pass n√†y ch·ªâ l√† l·ªõp ch·∫Øn UI th√¥i.
            // ƒê·ªÉ ƒë∆°n gi·∫£n cho user, m√¨nh d√πng chung pass m√† Script ƒëang d√πng ho·∫∑c pass user mu·ªën.
            // Logic: N·∫øu ƒë√∫ng, l∆∞u v√†o localStorage ƒë·ªÉ l·∫ßn sau kh·ªèi nh·∫≠p l·∫°i.
            
            // M√¨nh s·∫Ω cho ph√©p nh·∫≠p b·∫•t k·ª≥, nh∆∞ng g·ª≠i k√®m v·ªÅ server. 
            // N·∫øu server tr·∫£ v·ªÅ l·ªói sai pass th√¨ m·ªõi b√°o.
            // Nh∆∞ng ƒë·ªÉ UX t·ªët, m√¨nh check s∆° ·ªü ƒë√¢y tr∆∞·ªõc.
            // Gi·∫£ s·ª≠ pass ƒë√∫ng l√† "123456" ho·∫∑c ƒë·ªÉ tr·ªëng cho d·ªÖ test :)) 
            // Th√¥i l√†m check th·∫≠t lu√¥n: Ph·∫£i nh·∫≠p g√¨ ƒë√≥ m·ªõi cho qua
            
            if (pass.length > 0) {
                // L∆∞u pass v√†o b·ªô nh·ªõ t·∫°m ƒë·ªÉ d√πng g·ª≠i request
                localStorage.setItem('app_pass', pass);
                showApp();
            } else {
                loginError.classList.remove('hidden');
            }
        });
        // T·ª± ƒë·ªông ƒëƒÉng nh·∫≠p n·∫øu ƒë√£ l∆∞u pass
        if(localStorage.getItem('app_pass')) {
            showApp();
        }
        function showApp() {
            loginModal.classList.add('hidden');
            mainApp.classList.remove('hidden');
        }
        function logout() {
            localStorage.removeItem('app_pass');
            location.reload();
        }
        // 2. X·ª¨ L√ù G·ª¨I FORM (SUBMIT)
        reportForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Hi·ªáu ·ª©ng Loading
            const originalBtnContent = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="spinner"></div> ƒêang g·ª≠i...';
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
            // L·∫•y d·ªØ li·ªáu t·ª´ Form
            const formData = new FormData(reportForm);
            const data = {};
            formData.forEach((value, key) => data[key] = value);
            
            // Th√™m m·∫≠t kh·∫©u v√†o data ƒë·ªÉ server check
            data['password'] = "BiMatKhongDuocBatMi"; // M·∫≠t kh·∫©u kh·ªõp v·ªõi trong Script
            // G·ª≠i Request (D√πng fetch no-cors ƒë·ªÉ tr√°nh l·ªói CORS c·ªßa Google nh∆∞ng kh√≥ nh·∫≠n response)
            // Ho·∫∑c d√πng: application/x-www-form-urlencoded
            
            const params = new URLSearchParams(data);
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Quan tr·ªçng: Google Apps Script y√™u c·∫ßu c√°i n√†y n·∫øu g·ªçi t·ª´ client kh√°c domain
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params
            })
            .then(response => {
                // Do ch·∫ø ƒë·ªô no-cors, ta kh√¥ng ƒë·ªçc ƒë∆∞·ª£c n·ªôi dung tr·∫£ v·ªÅ JSON.
                // Nh∆∞ng n·∫øu kh√¥ng b√°o l·ªói network th√¨ coi nh∆∞ th√†nh c√¥ng 99%.
                
                // Reset form
                reportForm.reset();
                
                // Show th√¥ng b√°o th√†nh c√¥ng (Alert ƒë∆°n gi·∫£n ho·∫∑c Toast x·ªãn)
                alert("‚úÖ Th√†nh c√¥ng! ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o Sheet.");
            })
            .catch(error => {
                console.error('Error:', error);
                alert("‚ùå C√≥ l·ªói x·∫£y ra: " + error);
            })
            .finally(() => {
                // T·∫Øt hi·ªáu ·ª©ng Loading
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            });
        });
    </script>
</body>
</html>
